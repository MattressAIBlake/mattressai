{% schema %}
{
  "name": "MattressAI Widget",
  "target": "body",
  "settings": [
    { 
      "type": "header",
      "content": "Chat Bubble"
    },
    { 
      "type": "select", 
      "id": "bubble_style", 
      "label": "Bubble style", 
      "options": [
        { "value": "icon", "label": "Icon only" },
        { "value": "text", "label": "Text only" }
      ],
      "default": "text",
      "info": "What to display on the chat bubble"
    },
    { 
      "type": "text", 
      "id": "bubble_text", 
      "label": "Bubble text", 
      "default": "Mattress Match",
      "info": "Text shown on bubble (if text style selected)"
    },
    { 
      "type": "range", 
      "id": "bubble_size", 
      "label": "Bubble size", 
      "min": 52,
      "max": 80,
      "step": 4,
      "unit": "px",
      "default": 64,
      "info": "Height of the chat bubble button"
    },
    { 
      "type": "header",
      "content": "Widget Position"
    },
    { 
      "type": "select", 
      "id": "position_horizontal", 
      "label": "Horizontal position", 
      "options": [
        { "value": "left", "label": "Left" },
        { "value": "right", "label": "Right" }
      ],
      "default": "right",
      "info": "Which side of the screen to show the widget"
    },
    { 
      "type": "range", 
      "id": "position_bottom", 
      "label": "Bottom spacing", 
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20,
      "info": "Distance from bottom of screen"
    },
    { 
      "type": "range", 
      "id": "position_side", 
      "label": "Side spacing", 
      "min": 10,
      "max": 100,
      "step": 5,
      "unit": "px",
      "default": 20,
      "info": "Distance from left or right edge"
    },
    { 
      "type": "header",
      "content": "Colors & Branding"
    },
    { 
      "type": "color", 
      "id": "primary_color", 
      "label": "Primary color", 
      "default": "#3B82F6",
      "info": "Main color for buttons, header, and chat bubble"
    },
    { 
      "type": "color", 
      "id": "avatar_background", 
      "label": "Avatar background color", 
      "default": "#3B82F6",
      "info": "Background color for text-style avatars"
    },
    { 
      "type": "color", 
      "id": "header_text_color", 
      "label": "Header text color", 
      "default": "#FFFFFF",
      "info": "Color for widget title and subtitle in header"
    },
    { 
      "type": "color", 
      "id": "message_text_color", 
      "label": "Message text color", 
      "default": "#374151",
      "info": "Color for assistant message text"
    },
    { 
      "type": "header",
      "content": "Widget Text"
    },
    { 
      "type": "text", 
      "id": "widget_title", 
      "label": "Widget title", 
      "default": "Chat with us",
      "info": "Main heading shown in the chat widget header"
    },
    { 
      "type": "text", 
      "id": "widget_subtitle", 
      "label": "Widget subtitle", 
      "default": "We're here to help",
      "info": "Subtitle shown below the title in header"
    },
    { 
      "type": "textarea", 
      "id": "welcome_message", 
      "label": "Welcome message", 
      "default": "Hi! How can we help you today?",
      "info": "First message displayed to grab shopper attention"
    },
    { 
      "type": "header",
      "content": "Assistant Avatar"
    },
    { 
      "type": "select", 
      "id": "avatar_style", 
      "label": "Avatar style", 
      "options": [
        { "value": "text", "label": "Text/Initials" },
        { "value": "image", "label": "Custom image" }
      ],
      "default": "text",
      "info": "Choose text initials or upload a custom avatar image"
    },
    { 
      "type": "text", 
      "id": "avatar_text", 
      "label": "Avatar text", 
      "default": "AI",
      "info": "1-2 characters shown in avatar (if text style selected)"
    },
    { 
      "type": "image_picker", 
      "id": "avatar_image", 
      "label": "Avatar image", 
      "info": "Upload a square image for the avatar (if image style selected)"
    },
    { 
      "type": "header",
      "content": "Widget Behavior"
    },
    { 
      "type": "checkbox", 
      "id": "auto_open", 
      "label": "Auto open on first visit", 
      "default": false 
    }
  ]
}
{% endschema %}

<!-- MattressAI Widget Root -->
<div 
  id="mattressai-root" 
  data-tenant="{{ shop.permanent_domain | escape }}"
  data-auto-open="{{ block.settings.auto_open }}"
  data-primary-color="{{ block.settings.primary_color }}"
  data-widget-title="{{ block.settings.widget_title | escape }}"
  data-widget-subtitle="{{ block.settings.widget_subtitle | escape }}"
  data-welcome-message="{{ block.settings.welcome_message | escape }}"
  data-avatar-style="{{ block.settings.avatar_style }}"
  data-avatar-text="{{ block.settings.avatar_text | escape }}"
  data-avatar-image="{{ block.settings.avatar_image | image_url: width: 72, height: 72, crop: 'center' }}"
  data-avatar-background="{{ block.settings.avatar_background }}"
  data-header-text-color="{{ block.settings.header_text_color }}"
  data-message-text-color="{{ block.settings.message_text_color }}"
  data-bubble-style="{{ block.settings.bubble_style }}"
  data-bubble-text="{{ block.settings.bubble_text | escape }}"
  data-bubble-size="{{ block.settings.bubble_size }}"
  data-position-horizontal="{{ block.settings.position_horizontal }}"
  data-position-bottom="{{ block.settings.position_bottom }}"
  data-position-side="{{ block.settings.position_side }}"
></div>

<!-- Widget Assets -->
<script src="{{ 'tracking.js' | asset_url }}" data-tenant="{{ shop.permanent_domain | escape }}" defer></script>
<script src="{{ shop.url }}/apps/mattressai/widget.js?v=20" data-tenant="{{ shop.permanent_domain | escape }}" defer></script>
<link rel="stylesheet" href="{{ 'widget.css' | asset_url }}">